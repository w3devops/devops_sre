<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Week 1 Day 5: CI/CD, GitOps & Advanced Deployments - DevOps/SRE Learning Portfolio</title>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .content {
            background: white;
            border-radius: 10px;
            padding: 40px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .breadcrumb {
            background: #f8f9fa;
            padding: 10px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .breadcrumb a {
            color: #667eea;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        h1, h2, h3 {
            color: #667eea;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        h2 {
            font-size: 2rem;
            margin-top: 40px;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        h3 {
            font-size: 1.5rem;
            margin-top: 30px;
            margin-bottom: 15px;
        }

        .goal-box {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .task-list {
            list-style: none;
            padding: 0;
        }

        .task-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e1e4e8;
        }

        .task-list li:before {
            content: "üöÄ";
            margin-right: 10px;
            color: #667eea;
        }

        .component-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .component-box h3 {
            color: #667eea;
            margin-top: 0;
        }

        .mermaid {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            overflow-x: auto;
            max-width: 100%;
        }

        .mermaid svg {
            max-width: 100%;
            height: auto;
        }

        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #5a6fd8;
        }

        .nav-buttons {
            text-align: center;
            margin: 30px 0;
        }

        .flow-steps {
            counter-reset: step-counter;
            list-style: none;
            padding: 0;
        }

        .flow-steps li {
            counter-increment: step-counter;
            padding: 15px 0;
            border-bottom: 1px solid #e1e4e8;
            position: relative;
            padding-left: 50px;
        }

        .flow-steps li:before {
            content: counter(step-counter);
            position: absolute;
            left: 0;
            top: 15px;
            background: #667eea;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }

        .code-block .comment {
            color: #a0aec0;
        }

        .code-block .keyword {
            color: #9f7aea;
        }

        .code-block .string {
            color: #68d391;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .content {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .mermaid {
                padding: 10px;
                margin: 15px 0;
            }

            .mermaid svg {
                transform: scale(0.8);
                transform-origin: top left;
            }
        }

        @media (max-width: 480px) {
            .mermaid svg {
                transform: scale(0.6);
                transform-origin: top left;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üê≥ Week 1: Kubernetes, Docker, Networking, and Security</h1>
            <p>Day 5: CI/CD Integration, GitOps, and Advanced Deployment Strategies</p>
        </div>

        <div class="breadcrumb">
            <a href="../../index.html">Home</a> >
            <a href="../../documentation.html">Documentation</a> >
            <a href="../README.html">Week 1</a> >
            Day 5: CI/CD & GitOps
        </div>

        <div class="content">
            <h1>Day 5: CI/CD Integration, GitOps, and Advanced Deployment Strategies (6 hours)</h1>

            <div class="goal-box">
                <h3>üéØ Goal</h3>
                <p>Master CI/CD pipelines with Kubernetes, implement GitOps workflows, and learn advanced deployment patterns.</p>
            </div>

            <h2>üìö Learning Objectives</h2>
            <ul class="task-list">
                <li>Learn: CI/CD pipeline integration with Kubernetes</li>
                <li>Practice: GitOps workflows with ArgoCD and Flux</li>
                <li>Task: Implement automated deployment strategies</li>
                <li>Master: Advanced deployment patterns (Canary, Blue-Green)</li>
                <li>Resources: CI/CD tools and GitOps best practices</li>
            </ul>

            <h2>üöÄ CI/CD Pipeline Architecture</h2>
            <p>Modern CI/CD pipelines integrate seamlessly with Kubernetes to provide automated, reliable deployments with proper testing and validation.</p>

            <div class="component-box">
                <h3>üîÑ Pipeline Stages</h3>
                <ul>
                    <li><strong>Source Control:</strong> Code commit triggers pipeline</li>
                    <li><strong>Build & Test:</strong> Compile, test, and validate code</li>
                    <li><strong>Container Build:</strong> Create and push container images</li>
                    <li><strong>Security Scanning:</strong> Scan images for vulnerabilities</li>
                    <li><strong>Deploy:</strong> Deploy to Kubernetes clusters</li>
                    <li><strong>Verification:</strong> Test deployment and functionality</li>
                </ul>
            </div>

            <h2>üîÑ GitOps Workflow</h2>

            <div class="mermaid">
                graph TB
                    subgraph "GitOps Workflow"
                        DEV[Developer<br/>Git Push]
                        CI[CI Pipeline<br/>Build & Test]
                        REGISTRY[Container Registry<br/>Push Image]
                        GIT[Git Repository<br/>Manifest Update]
                        CD[CD System<br/>ArgoCD/Flux]
                        K8S[Kubernetes<br/>Apply Changes]
                        MONITOR[Monitor &<br/>Validate]
                    end

                    DEV --> CI
                    CI --> REGISTRY
                    REGISTRY --> GIT
                    GIT --> CD
                    CD --> K8S
                    K8S --> MONITOR
                    MONITOR --> GIT

                    %% Styling
                    classDef development fill:#e1f5fe,stroke:#01579b,stroke-width:2px
                    classDef cicd fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
                    classDef platform fill:#e8f5e8,stroke:#2e7d32,stroke-width:1px

                    class DEV,CI development
                    class REGISTRY,GIT,CD cicd
                    class K8S,MONITOR platform
            </div>

            <h2>üöÄ Hands-On Practice: CI/CD Setup</h2>

            <div class="component-box">
                <h3>üìù Step 1: GitHub Actions Pipeline</h3>
                <p>Create a GitHub Actions workflow for Kubernetes deployment:</p>

                <div class="code-block">
<span class="keyword">name</span>: <span class="string">CI/CD Pipeline</span>

<span class="keyword">on</span>:
  <span class="keyword">push</span>:
    <span class="keyword">branches</span>: [<span class="string">main</span>]
  <span class="keyword">pull_request</span>:
    <span class="keyword">branches</span>: [<span class="string">main</span>]

<span class="keyword">jobs</span>:
  <span class="keyword">build-and-deploy</span>:
    <span class="keyword">runs-on</span>: <span class="string">ubuntu-latest</span>

    <span class="keyword">steps</span>:
    - <span class="keyword">uses</span>: <span class="string">actions/checkout@v3</span>

    - <span class="keyword">name</span>: <span class="string">Set up Docker Buildx</span>
      <span class="keyword">uses</span>: <span class="string">docker/setup-buildx-action@v2</span>

    - <span class="keyword">name</span>: <span class="string">Log in to Container Registry</span>
      <span class="keyword">uses</span>: <span class="string">docker/login-action@v2</span>
      <span class="keyword">with</span>:
        <span class="keyword">registry</span>: <span class="string">${{ secrets.REGISTRY_URL }}</span>
        <span class="keyword">username</span>: <span class="string">${{ secrets.REGISTRY_USERNAME }}</span>
        <span class="keyword">password</span>: <span class="string">${{ secrets.REGISTRY_PASSWORD }}</span>

    - <span class="keyword">name</span>: <span class="string">Build and push Docker image</span>
      <span class="keyword">uses</span>: <span class="string">docker/build-push-action@v4</span>
      <span class="keyword">with</span>:
        <span class="keyword">context</span>: <span class="string">.</span>
        <span class="keyword">push</span>: <span class="string">true</span>
        <span class="keyword">tags</span>: <span class="string">${{ secrets.REGISTRY_URL }}/myapp:${{ github.sha }}</span>

    - <span class="keyword">name</span>: <span class="string">Configure kubectl</span>
      <span class="keyword">uses</span>: <span class="string">azure/k8s-set-context@v3</span>
      <span class="keyword">with</span>:
        <span class="keyword">kubeconfig</span>: <span class="string">${{ secrets.KUBE_CONFIG }}</span>

    - <span class="keyword">name</span>: <span class="string">Deploy to Kubernetes</span>
      <span class="keyword">run</span>: <span class="string">|</span>
        <span class="string">sed -i "s|IMAGE_TAG|${{ secrets.REGISTRY_URL }}/myapp:${{ github.sha }}|g" k8s/deployment.yaml</span>
        <span class="string">kubectl apply -f k8s/</span>
        <span class="string">kubectl rollout status deployment/myapp</span>
</div>

                <h4>Create the workflow file:</h4>
                <pre><code>mkdir -p .github/workflows
cat > .github/workflows/ci-cd.yml << 'EOF'
[paste the above workflow content]
EOF</code></pre>
            </div>

            <div class="component-box">
                <h3>üîß Step 2: ArgoCD GitOps Setup</h3>
                <p>Install and configure ArgoCD for GitOps:</p>

                <h4>Install ArgoCD:</h4>
                <pre><code>kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml</code></pre>

                <h4>Access ArgoCD:</h4>
                <pre><code>kubectl port-forward svc/argocd-server -n argocd 8080:443
# Username: admin
# Password: kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d</code></pre>
            </div>

            <h2>üéØ Advanced Deployment Strategies</h2>

            <div class="component-box">
                <h3>üê¶ Canary Deployments</h3>
                <p>Implement canary deployments for gradual rollouts:</p>

                <div class="code-block">
<span class="keyword">apiVersion</span>: <span class="string">argoproj.io/v1alpha1</span>
<span class="keyword">kind</span>: <span class="string">Rollout</span>
<span class="keyword">metadata</span>:
  <span class="keyword">name</span>: <span class="string">myapp-canary</span>
<span class="keyword">spec</span>:
  <span class="keyword">replicas</span>: <span class="string">10</span>
  <span class="keyword">strategy</span>:
    <span class="keyword">canary</span>:
      <span class="keyword">stableService</span>: <span class="string">myapp-stable</span>
      <span class="keyword">canaryService</span>: <span class="string">myapp-canary</span>
      <span class="keyword">steps</span>:
      - <span class="keyword">setWeight</span>: <span class="string">10</span>
      - <span class="keyword">pause</span>: <span class="string">{}</span>
      - <span class="keyword">setWeight</span>: <span class="string">50</span>
      - <span class="keyword">pause</span>: <span class="string">{duration: 60}</span>
      - <span class="keyword">setWeight</span>: <span class="string">100</span>
  <span class="keyword">selector</span>:
    <span class="keyword">matchLabels</span>:
      <span class="keyword">app</span>: <span class="string">myapp</span>
  <span class="keyword">template</span>:
    <span class="keyword">metadata</span>:
      <span class="keyword">labels</span>:
        <span class="keyword">app</span>: <span class="string">myapp</span>
    <span class="keyword">spec</span>:
      <span class="keyword">containers</span>:
      - <span class="keyword">name</span>: <span class="string">myapp</span>
        <span class="keyword">image</span>: <span class="string">myapp:v1.0.0</span>
        <span class="keyword">ports</span>:
        - <span class="keyword">containerPort</span>: <span class="string">8080</span>
</div>

                <h4>Apply canary deployment:</h4>
                <pre><code>kubectl apply -f practice/canary-rollout.yaml</code></pre>
            </div>

            <div class="component-box">
                <h3>üîÄ Blue-Green Deployments</h3>
                <p>Set up blue-green deployment strategy:</p>

                <div class="code-block">
<span class="keyword">apiVersion</span>: <span class="string">v1</span>
<span class="keyword">kind</span>: <span class="string">Service</span>
<span class="keyword">metadata</span>:
  <span class="keyword">name</span>: <span class="string">myapp-service</span>
<span class="keyword">spec</span>:
  <span class="keyword">type</span>: <span class="string">ClusterIP</span>
  <span class="keyword">selector</span>:
    <span class="keyword">app</span>: <span class="string">myapp</span>
    <span class="keyword">version</span>: <span class="string">blue</span>  <span class="comment"># Switch between blue/green</span>
  <span class="keyword">ports</span>:
  - <span class="keyword">port</span>: <span class="string">80</span>
    <span class="keyword">targetPort</span>: <span class="string">8080</span>

---
<span class="keyword">apiVersion</span>: <span class="string">apps/v1</span>
<span class="keyword">kind</span>: <span class="string">Deployment</span>
<span class="keyword">metadata</span>:
  <span class="keyword">name</span>: <span class="string">myapp-blue</span>
<span class="keyword">spec</span>:
  <span class="keyword">replicas</span>: <span class="string">3</span>
  <span class="keyword">selector</span>:
    <span class="keyword">matchLabels</span>:
      <span class="keyword">app</span>: <span class="string">myapp</span>
      <span class="keyword">version</span>: <span class="string">blue</span>
  <span class="keyword">template</span>:
    <span class="keyword">metadata</span>:
      <span class="keyword">labels</span>:
        <span class="keyword">app</span>: <span class="string">myapp</span>
        <span class="keyword">version</span>: <span class="string">blue</span>
    <span class="keyword">spec</span>:
      <span class="keyword">containers</span>:
      - <span class="keyword">name</span>: <span class="string">myapp</span>
        <span class="keyword">image</span>: <span class="string">myapp:v1.0.0</span>
        <span class="keyword">ports</span>:
        - <span class="keyword">containerPort</span>: <span class="string">8080</span>

---
<span class="keyword">apiVersion</span>: <span class="string">apps/v1</span>
<span class="keyword">kind</span>: <span class="string">Deployment</span>
<span class="keyword">metadata</span>:
  <span class="keyword">name</span>: <span class="string">myapp-green</span>
<span class="keyword">spec</span>:
  <span class="keyword">replicas</span>: <span class="string">0</span>  <span class="comment"># Start with 0 replicas</span>
  <span class="keyword">selector</span>:
    <span class="keyword">matchLabels</span>:
      <span class="keyword">app</span>: <span class="string">myapp</span>
      <span class="keyword">version</span>: <span class="string">green</span>
  <span class="keyword">template</span>:
    <span class="keyword">metadata</span>:
      <span class="keyword">labels</span>:
        <span class="keyword">app</span>: <span class="string">myapp</span>
        <span class="keyword">version</span>: <span class="string">green</span>
    <span class="keyword">spec</span>:
      <span class="keyword">containers</span>:
      - <span class="keyword">name</span>: <span class="string">myapp</span>
        <span class="keyword">image</span>: <span class="string">myapp:v1.1.0</span>
        <span class="keyword">ports</span>:
        - <span class="keyword">containerPort</span>: <span class="string">8080</span>
</div>

                <h4>Switch to green version:</h4>
                <pre><code># Scale down blue
kubectl scale deployment myapp-blue --replicas=0

# Scale up green
kubectl scale deployment myapp-green --replicas=3

# Update service selector
kubectl patch svc myapp-service -p '{"spec":{"selector":{"version":"green"}}}'</code></pre>
            </div>

            <h2>üîß Essential Commands</h2>

            <div class="component-box">
                <h3>üöÄ ArgoCD Commands</h3>
                <pre><code># Get ArgoCD password
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

# Create application
argocd app create myapp --repo https://github.com/myorg/myapp-manifests --path k8s --dest-server https://kubernetes.default.svc --dest-namespace default

# Sync application
argocd app sync myapp

# Check application status
argocd app get myapp

# View application diff
argocd app diff myapp</code></pre>
            </div>

            <div class="component-box">
                <h3>üîÑ Deployment Strategy Commands</h3>
                <pre><code># Promote canary deployment
kubectl argo rollouts promote myapp-canary

# Check rollout status
kubectl argo rollouts get rollout myapp-canary

# Abort canary deployment
kubectl argo rollouts abort myapp-canary

# Retry failed step
kubectl argo rollouts retry myapp-canary

# View rollout history
kubectl argo rollouts list rollouts</code></pre>
            </div>

            <h2>üìö Daily Tasks</h2>
            <div class="goal-box">
                <h3>‚úÖ Today's Checklist</h3>
                <ul class="task-list">
                    <li>Set up GitHub Actions CI/CD pipeline</li>
                    <li>Install and configure ArgoCD for GitOps</li>
                    <li>Create automated deployment workflows</li>
                    <li>Implement canary deployment strategy</li>
                    <li>Set up blue-green deployment pattern</li>
                    <li>Configure multi-environment deployments</li>
                    <li>Practice rollback and recovery procedures</li>
                </ul>
            </div>

            <h2>üéØ Best Practices</h2>
            <div class="component-box">
                <h3>üîÑ CI/CD Best Practices</h3>
                <ul>
                    <li><strong>Automated Testing:</strong> Test at every stage of the pipeline</li>
                    <li><strong>Security Scanning:</strong> Scan images and dependencies</li>
                    <li><strong>Immutable Infrastructure:</strong> Treat infrastructure as code</li>
                    <li><strong>Rollback Strategy:</strong> Always have rollback procedures</li>
                    <li><strong>Environment Parity:</strong> Keep environments consistent</li>
                </ul>
            </div>

            <div class="component-box">
                <h3>üöÄ GitOps Best Practices</h3>
                <ul>
                    <li><strong>Single Source of Truth:</strong> Everything defined in Git</li>
                    <li><strong>Declarative Configuration:</strong> Desired state over imperative commands</li>
                    <li><strong>Automated Sync:</strong> Automatic reconciliation of desired vs actual state</li>
                    <li><strong>Branch Protection:</strong> Protect main branches with proper reviews</li>
                    <li><strong>Gradual Rollouts:</strong> Use canary deployments for risky changes</li>
                </ul>
            </div>

            <h2>üìö Resources</h2>
            <ul>
                <li><a href="https://argoproj.github.io/argo-cd/" target="_blank">ArgoCD Documentation</a></li>
                <li><a href="https://fluxcd.io/" target="_blank">Flux GitOps</a></li>
                <li><a href="https://argoproj.github.io/argo-rollouts/" target="_blank">Argo Rollouts</a></li>
                <li><a href="https://docs.github.com/en/actions" target="_blank">GitHub Actions</a></li>
            </ul>

            <div class="nav-buttons">
                <a href="../Day4/README.html" class="btn">‚Üê Previous: Day 4</a>
                <a href="../../index.html" class="btn">‚Üê Back to Home</a>
                <a href="../../documentation.html" class="btn">‚Üê Back to Documentation</a>
                <a href="../README.html" class="btn">‚Üê Back to Week 1</a>
                <a href="practice/" class="btn">üöÄ Practice Exercises</a>
                <a href="../Day6/README.html" class="btn">Next: Day 6 - Multi-Cluster & Operations ‚Üí</a>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid with mobile-friendly settings
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose',
            responsive: true
        });

        // Handle mobile viewport
        function adjustMermaidForMobile() {
            const mermaidDivs = document.querySelectorAll('.mermaid');
            mermaidDivs.forEach(div => {
                const svg = div.querySelector('svg');
                if (svg && window.innerWidth <= 768) {
                    svg.style.maxWidth = '100%';
                    svg.style.height = 'auto';
                }
            });
        }

        // Adjust on load and resize
        window.addEventListener('load', adjustMermaidForMobile);
        window.addEventListener('resize', adjustMermaidForMobile);
    </script>
</body>
</html>